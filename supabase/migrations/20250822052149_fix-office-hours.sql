create type "public"."help_request_creation_notification" as enum ('all', 'only_active_queue', 'none');

revoke delete on table "public"."assignment_due_date_exceptions" from "anon";

revoke insert on table "public"."assignment_due_date_exceptions" from "anon";

revoke references on table "public"."assignment_due_date_exceptions" from "anon";

revoke select on table "public"."assignment_due_date_exceptions" from "anon";

revoke trigger on table "public"."assignment_due_date_exceptions" from "anon";

revoke truncate on table "public"."assignment_due_date_exceptions" from "anon";

revoke update on table "public"."assignment_due_date_exceptions" from "anon";

revoke delete on table "public"."assignment_group_invitations" from "anon";

revoke insert on table "public"."assignment_group_invitations" from "anon";

revoke references on table "public"."assignment_group_invitations" from "anon";

revoke select on table "public"."assignment_group_invitations" from "anon";

revoke trigger on table "public"."assignment_group_invitations" from "anon";

revoke truncate on table "public"."assignment_group_invitations" from "anon";

revoke update on table "public"."assignment_group_invitations" from "anon";

revoke delete on table "public"."assignment_group_join_request" from "anon";

revoke insert on table "public"."assignment_group_join_request" from "anon";

revoke references on table "public"."assignment_group_join_request" from "anon";

revoke select on table "public"."assignment_group_join_request" from "anon";

revoke trigger on table "public"."assignment_group_join_request" from "anon";

revoke truncate on table "public"."assignment_group_join_request" from "anon";

revoke update on table "public"."assignment_group_join_request" from "anon";

revoke delete on table "public"."assignment_groups" from "anon";

revoke insert on table "public"."assignment_groups" from "anon";

revoke references on table "public"."assignment_groups" from "anon";

revoke select on table "public"."assignment_groups" from "anon";

revoke trigger on table "public"."assignment_groups" from "anon";

revoke truncate on table "public"."assignment_groups" from "anon";

revoke update on table "public"."assignment_groups" from "anon";

revoke delete on table "public"."assignment_groups_members" from "anon";

revoke insert on table "public"."assignment_groups_members" from "anon";

revoke references on table "public"."assignment_groups_members" from "anon";

revoke select on table "public"."assignment_groups_members" from "anon";

revoke trigger on table "public"."assignment_groups_members" from "anon";

revoke truncate on table "public"."assignment_groups_members" from "anon";

revoke update on table "public"."assignment_groups_members" from "anon";

revoke delete on table "public"."assignment_handout_commits" from "anon";

revoke insert on table "public"."assignment_handout_commits" from "anon";

revoke references on table "public"."assignment_handout_commits" from "anon";

revoke select on table "public"."assignment_handout_commits" from "anon";

revoke trigger on table "public"."assignment_handout_commits" from "anon";

revoke truncate on table "public"."assignment_handout_commits" from "anon";

revoke update on table "public"."assignment_handout_commits" from "anon";

revoke delete on table "public"."assignment_self_review_settings" from "anon";

revoke insert on table "public"."assignment_self_review_settings" from "anon";

revoke references on table "public"."assignment_self_review_settings" from "anon";

revoke select on table "public"."assignment_self_review_settings" from "anon";

revoke trigger on table "public"."assignment_self_review_settings" from "anon";

revoke truncate on table "public"."assignment_self_review_settings" from "anon";

revoke update on table "public"."assignment_self_review_settings" from "anon";

revoke delete on table "public"."assignments" from "anon";

revoke insert on table "public"."assignments" from "anon";

revoke references on table "public"."assignments" from "anon";

revoke select on table "public"."assignments" from "anon";

revoke trigger on table "public"."assignments" from "anon";

revoke truncate on table "public"."assignments" from "anon";

revoke update on table "public"."assignments" from "anon";

revoke delete on table "public"."audit" from "anon";

revoke insert on table "public"."audit" from "anon";

revoke references on table "public"."audit" from "anon";

revoke select on table "public"."audit" from "anon";

revoke trigger on table "public"."audit" from "anon";

revoke truncate on table "public"."audit" from "anon";

revoke update on table "public"."audit" from "anon";

revoke delete on table "public"."autograder" from "anon";

revoke insert on table "public"."autograder" from "anon";

revoke references on table "public"."autograder" from "anon";

revoke select on table "public"."autograder" from "anon";

revoke trigger on table "public"."autograder" from "anon";

revoke truncate on table "public"."autograder" from "anon";

revoke update on table "public"."autograder" from "anon";

revoke delete on table "public"."autograder_commits" from "anon";

revoke insert on table "public"."autograder_commits" from "anon";

revoke references on table "public"."autograder_commits" from "anon";

revoke select on table "public"."autograder_commits" from "anon";

revoke trigger on table "public"."autograder_commits" from "anon";

revoke truncate on table "public"."autograder_commits" from "anon";

revoke update on table "public"."autograder_commits" from "anon";

revoke delete on table "public"."autograder_regression_test" from "anon";

revoke insert on table "public"."autograder_regression_test" from "anon";

revoke references on table "public"."autograder_regression_test" from "anon";

revoke select on table "public"."autograder_regression_test" from "anon";

revoke trigger on table "public"."autograder_regression_test" from "anon";

revoke truncate on table "public"."autograder_regression_test" from "anon";

revoke update on table "public"."autograder_regression_test" from "anon";

revoke delete on table "public"."class_sections" from "anon";

revoke insert on table "public"."class_sections" from "anon";

revoke references on table "public"."class_sections" from "anon";

revoke select on table "public"."class_sections" from "anon";

revoke trigger on table "public"."class_sections" from "anon";

revoke truncate on table "public"."class_sections" from "anon";

revoke update on table "public"."class_sections" from "anon";

revoke delete on table "public"."classes" from "anon";

revoke insert on table "public"."classes" from "anon";

revoke references on table "public"."classes" from "anon";

revoke select on table "public"."classes" from "anon";

revoke trigger on table "public"."classes" from "anon";

revoke truncate on table "public"."classes" from "anon";

revoke update on table "public"."classes" from "anon";

revoke delete on table "public"."discussion_thread_likes" from "anon";

revoke insert on table "public"."discussion_thread_likes" from "anon";

revoke references on table "public"."discussion_thread_likes" from "anon";

revoke select on table "public"."discussion_thread_likes" from "anon";

revoke trigger on table "public"."discussion_thread_likes" from "anon";

revoke truncate on table "public"."discussion_thread_likes" from "anon";

revoke update on table "public"."discussion_thread_likes" from "anon";

revoke delete on table "public"."discussion_thread_ordinal_counters" from "anon";

revoke insert on table "public"."discussion_thread_ordinal_counters" from "anon";

revoke references on table "public"."discussion_thread_ordinal_counters" from "anon";

revoke select on table "public"."discussion_thread_ordinal_counters" from "anon";

revoke trigger on table "public"."discussion_thread_ordinal_counters" from "anon";

revoke truncate on table "public"."discussion_thread_ordinal_counters" from "anon";

revoke update on table "public"."discussion_thread_ordinal_counters" from "anon";

revoke delete on table "public"."discussion_thread_read_status" from "anon";

revoke insert on table "public"."discussion_thread_read_status" from "anon";

revoke references on table "public"."discussion_thread_read_status" from "anon";

revoke select on table "public"."discussion_thread_read_status" from "anon";

revoke trigger on table "public"."discussion_thread_read_status" from "anon";

revoke truncate on table "public"."discussion_thread_read_status" from "anon";

revoke update on table "public"."discussion_thread_read_status" from "anon";

revoke delete on table "public"."discussion_thread_watcher_cache" from "anon";

revoke insert on table "public"."discussion_thread_watcher_cache" from "anon";

revoke references on table "public"."discussion_thread_watcher_cache" from "anon";

revoke select on table "public"."discussion_thread_watcher_cache" from "anon";

revoke trigger on table "public"."discussion_thread_watcher_cache" from "anon";

revoke truncate on table "public"."discussion_thread_watcher_cache" from "anon";

revoke update on table "public"."discussion_thread_watcher_cache" from "anon";

revoke delete on table "public"."discussion_thread_watchers" from "anon";

revoke insert on table "public"."discussion_thread_watchers" from "anon";

revoke references on table "public"."discussion_thread_watchers" from "anon";

revoke select on table "public"."discussion_thread_watchers" from "anon";

revoke trigger on table "public"."discussion_thread_watchers" from "anon";

revoke truncate on table "public"."discussion_thread_watchers" from "anon";

revoke update on table "public"."discussion_thread_watchers" from "anon";

revoke delete on table "public"."discussion_threads" from "anon";

revoke insert on table "public"."discussion_threads" from "anon";

revoke references on table "public"."discussion_threads" from "anon";

revoke select on table "public"."discussion_threads" from "anon";

revoke trigger on table "public"."discussion_threads" from "anon";

revoke truncate on table "public"."discussion_threads" from "anon";

revoke update on table "public"."discussion_threads" from "anon";

revoke delete on table "public"."discussion_topics" from "anon";

revoke insert on table "public"."discussion_topics" from "anon";

revoke references on table "public"."discussion_topics" from "anon";

revoke select on table "public"."discussion_topics" from "anon";

revoke trigger on table "public"."discussion_topics" from "anon";

revoke truncate on table "public"."discussion_topics" from "anon";

revoke update on table "public"."discussion_topics" from "anon";

revoke delete on table "public"."email_batches" from "anon";

revoke insert on table "public"."email_batches" from "anon";

revoke references on table "public"."email_batches" from "anon";

revoke select on table "public"."email_batches" from "anon";

revoke trigger on table "public"."email_batches" from "anon";

revoke truncate on table "public"."email_batches" from "anon";

revoke update on table "public"."email_batches" from "anon";

revoke delete on table "public"."emails" from "anon";

revoke insert on table "public"."emails" from "anon";

revoke references on table "public"."emails" from "anon";

revoke select on table "public"."emails" from "anon";

revoke trigger on table "public"."emails" from "anon";

revoke truncate on table "public"."emails" from "anon";

revoke update on table "public"."emails" from "anon";

revoke delete on table "public"."flashcard_decks" from "anon";

revoke insert on table "public"."flashcard_decks" from "anon";

revoke references on table "public"."flashcard_decks" from "anon";

revoke select on table "public"."flashcard_decks" from "anon";

revoke trigger on table "public"."flashcard_decks" from "anon";

revoke truncate on table "public"."flashcard_decks" from "anon";

revoke update on table "public"."flashcard_decks" from "anon";

revoke delete on table "public"."flashcard_interaction_logs" from "anon";

revoke insert on table "public"."flashcard_interaction_logs" from "anon";

revoke references on table "public"."flashcard_interaction_logs" from "anon";

revoke select on table "public"."flashcard_interaction_logs" from "anon";

revoke trigger on table "public"."flashcard_interaction_logs" from "anon";

revoke truncate on table "public"."flashcard_interaction_logs" from "anon";

revoke update on table "public"."flashcard_interaction_logs" from "anon";

revoke delete on table "public"."flashcards" from "anon";

revoke insert on table "public"."flashcards" from "anon";

revoke references on table "public"."flashcards" from "anon";

revoke select on table "public"."flashcards" from "anon";

revoke trigger on table "public"."flashcards" from "anon";

revoke truncate on table "public"."flashcards" from "anon";

revoke update on table "public"."flashcards" from "anon";

revoke delete on table "public"."gradebook_column_students" from "anon";

revoke insert on table "public"."gradebook_column_students" from "anon";

revoke references on table "public"."gradebook_column_students" from "anon";

revoke select on table "public"."gradebook_column_students" from "anon";

revoke trigger on table "public"."gradebook_column_students" from "anon";

revoke truncate on table "public"."gradebook_column_students" from "anon";

revoke update on table "public"."gradebook_column_students" from "anon";

revoke delete on table "public"."gradebook_columns" from "anon";

revoke insert on table "public"."gradebook_columns" from "anon";

revoke references on table "public"."gradebook_columns" from "anon";

revoke select on table "public"."gradebook_columns" from "anon";

revoke trigger on table "public"."gradebook_columns" from "anon";

revoke truncate on table "public"."gradebook_columns" from "anon";

revoke update on table "public"."gradebook_columns" from "anon";

revoke delete on table "public"."gradebooks" from "anon";

revoke insert on table "public"."gradebooks" from "anon";

revoke references on table "public"."gradebooks" from "anon";

revoke select on table "public"."gradebooks" from "anon";

revoke trigger on table "public"."gradebooks" from "anon";

revoke truncate on table "public"."gradebooks" from "anon";

revoke update on table "public"."gradebooks" from "anon";

revoke delete on table "public"."grader_keys" from "anon";

revoke insert on table "public"."grader_keys" from "anon";

revoke references on table "public"."grader_keys" from "anon";

revoke select on table "public"."grader_keys" from "anon";

revoke trigger on table "public"."grader_keys" from "anon";

revoke truncate on table "public"."grader_keys" from "anon";

revoke update on table "public"."grader_keys" from "anon";

revoke delete on table "public"."grader_result_output" from "anon";

revoke insert on table "public"."grader_result_output" from "anon";

revoke references on table "public"."grader_result_output" from "anon";

revoke select on table "public"."grader_result_output" from "anon";

revoke trigger on table "public"."grader_result_output" from "anon";

revoke truncate on table "public"."grader_result_output" from "anon";

revoke update on table "public"."grader_result_output" from "anon";

revoke delete on table "public"."grader_result_test_output" from "anon";

revoke insert on table "public"."grader_result_test_output" from "anon";

revoke references on table "public"."grader_result_test_output" from "anon";

revoke select on table "public"."grader_result_test_output" from "anon";

revoke trigger on table "public"."grader_result_test_output" from "anon";

revoke truncate on table "public"."grader_result_test_output" from "anon";

revoke update on table "public"."grader_result_test_output" from "anon";

revoke delete on table "public"."grader_result_tests" from "anon";

revoke insert on table "public"."grader_result_tests" from "anon";

revoke references on table "public"."grader_result_tests" from "anon";

revoke select on table "public"."grader_result_tests" from "anon";

revoke trigger on table "public"."grader_result_tests" from "anon";

revoke truncate on table "public"."grader_result_tests" from "anon";

revoke update on table "public"."grader_result_tests" from "anon";

revoke delete on table "public"."grader_results" from "anon";

revoke insert on table "public"."grader_results" from "anon";

revoke references on table "public"."grader_results" from "anon";

revoke select on table "public"."grader_results" from "anon";

revoke trigger on table "public"."grader_results" from "anon";

revoke truncate on table "public"."grader_results" from "anon";

revoke update on table "public"."grader_results" from "anon";

revoke delete on table "public"."grading_conflicts" from "anon";

revoke insert on table "public"."grading_conflicts" from "anon";

revoke references on table "public"."grading_conflicts" from "anon";

revoke select on table "public"."grading_conflicts" from "anon";

revoke trigger on table "public"."grading_conflicts" from "anon";

revoke truncate on table "public"."grading_conflicts" from "anon";

revoke update on table "public"."grading_conflicts" from "anon";

revoke delete on table "public"."help_queue_assignments" from "anon";

revoke insert on table "public"."help_queue_assignments" from "anon";

revoke references on table "public"."help_queue_assignments" from "anon";

revoke select on table "public"."help_queue_assignments" from "anon";

revoke trigger on table "public"."help_queue_assignments" from "anon";

revoke truncate on table "public"."help_queue_assignments" from "anon";

revoke update on table "public"."help_queue_assignments" from "anon";

revoke delete on table "public"."help_queues" from "anon";

revoke insert on table "public"."help_queues" from "anon";

revoke references on table "public"."help_queues" from "anon";

revoke select on table "public"."help_queues" from "anon";

revoke trigger on table "public"."help_queues" from "anon";

revoke truncate on table "public"."help_queues" from "anon";

revoke update on table "public"."help_queues" from "anon";

revoke delete on table "public"."help_request_feedback" from "anon";

revoke insert on table "public"."help_request_feedback" from "anon";

revoke references on table "public"."help_request_feedback" from "anon";

revoke select on table "public"."help_request_feedback" from "anon";

revoke trigger on table "public"."help_request_feedback" from "anon";

revoke truncate on table "public"."help_request_feedback" from "anon";

revoke update on table "public"."help_request_feedback" from "anon";

revoke delete on table "public"."help_request_file_references" from "anon";

revoke insert on table "public"."help_request_file_references" from "anon";

revoke references on table "public"."help_request_file_references" from "anon";

revoke select on table "public"."help_request_file_references" from "anon";

revoke trigger on table "public"."help_request_file_references" from "anon";

revoke truncate on table "public"."help_request_file_references" from "anon";

revoke update on table "public"."help_request_file_references" from "anon";

revoke delete on table "public"."help_request_message_read_receipts" from "anon";

revoke insert on table "public"."help_request_message_read_receipts" from "anon";

revoke references on table "public"."help_request_message_read_receipts" from "anon";

revoke select on table "public"."help_request_message_read_receipts" from "anon";

revoke trigger on table "public"."help_request_message_read_receipts" from "anon";

revoke truncate on table "public"."help_request_message_read_receipts" from "anon";

revoke update on table "public"."help_request_message_read_receipts" from "anon";

revoke delete on table "public"."help_request_messages" from "anon";

revoke insert on table "public"."help_request_messages" from "anon";

revoke references on table "public"."help_request_messages" from "anon";

revoke select on table "public"."help_request_messages" from "anon";

revoke trigger on table "public"."help_request_messages" from "anon";

revoke truncate on table "public"."help_request_messages" from "anon";

revoke update on table "public"."help_request_messages" from "anon";

revoke delete on table "public"."help_request_moderation" from "anon";

revoke insert on table "public"."help_request_moderation" from "anon";

revoke references on table "public"."help_request_moderation" from "anon";

revoke select on table "public"."help_request_moderation" from "anon";

revoke trigger on table "public"."help_request_moderation" from "anon";

revoke truncate on table "public"."help_request_moderation" from "anon";

revoke update on table "public"."help_request_moderation" from "anon";

revoke delete on table "public"."help_request_students" from "anon";

revoke insert on table "public"."help_request_students" from "anon";

revoke references on table "public"."help_request_students" from "anon";

revoke select on table "public"."help_request_students" from "anon";

revoke trigger on table "public"."help_request_students" from "anon";

revoke truncate on table "public"."help_request_students" from "anon";

revoke update on table "public"."help_request_students" from "anon";

revoke delete on table "public"."help_request_templates" from "anon";

revoke insert on table "public"."help_request_templates" from "anon";

revoke references on table "public"."help_request_templates" from "anon";

revoke select on table "public"."help_request_templates" from "anon";

revoke trigger on table "public"."help_request_templates" from "anon";

revoke truncate on table "public"."help_request_templates" from "anon";

revoke update on table "public"."help_request_templates" from "anon";

revoke delete on table "public"."help_request_watchers" from "anon";

revoke insert on table "public"."help_request_watchers" from "anon";

revoke references on table "public"."help_request_watchers" from "anon";

revoke select on table "public"."help_request_watchers" from "anon";

revoke trigger on table "public"."help_request_watchers" from "anon";

revoke truncate on table "public"."help_request_watchers" from "anon";

revoke update on table "public"."help_request_watchers" from "anon";

revoke delete on table "public"."help_requests" from "anon";

revoke insert on table "public"."help_requests" from "anon";

revoke references on table "public"."help_requests" from "anon";

revoke select on table "public"."help_requests" from "anon";

revoke trigger on table "public"."help_requests" from "anon";

revoke truncate on table "public"."help_requests" from "anon";

revoke update on table "public"."help_requests" from "anon";

revoke delete on table "public"."invitations" from "anon";

revoke insert on table "public"."invitations" from "anon";

revoke references on table "public"."invitations" from "anon";

revoke select on table "public"."invitations" from "anon";

revoke trigger on table "public"."invitations" from "anon";

revoke truncate on table "public"."invitations" from "anon";

revoke update on table "public"."invitations" from "anon";

revoke delete on table "public"."lab_section_meetings" from "anon";

revoke insert on table "public"."lab_section_meetings" from "anon";

revoke references on table "public"."lab_section_meetings" from "anon";

revoke select on table "public"."lab_section_meetings" from "anon";

revoke trigger on table "public"."lab_section_meetings" from "anon";

revoke truncate on table "public"."lab_section_meetings" from "anon";

revoke update on table "public"."lab_section_meetings" from "anon";

revoke delete on table "public"."lab_sections" from "anon";

revoke insert on table "public"."lab_sections" from "anon";

revoke references on table "public"."lab_sections" from "anon";

revoke select on table "public"."lab_sections" from "anon";

revoke trigger on table "public"."lab_sections" from "anon";

revoke truncate on table "public"."lab_sections" from "anon";

revoke update on table "public"."lab_sections" from "anon";

revoke delete on table "public"."name_generation_words" from "anon";

revoke insert on table "public"."name_generation_words" from "anon";

revoke references on table "public"."name_generation_words" from "anon";

revoke select on table "public"."name_generation_words" from "anon";

revoke trigger on table "public"."name_generation_words" from "anon";

revoke truncate on table "public"."name_generation_words" from "anon";

revoke update on table "public"."name_generation_words" from "anon";

revoke delete on table "public"."notification_preferences" from "anon";

revoke insert on table "public"."notification_preferences" from "anon";

revoke references on table "public"."notification_preferences" from "anon";

revoke select on table "public"."notification_preferences" from "anon";

revoke trigger on table "public"."notification_preferences" from "anon";

revoke truncate on table "public"."notification_preferences" from "anon";

revoke update on table "public"."notification_preferences" from "anon";

revoke delete on table "public"."notifications" from "anon";

revoke insert on table "public"."notifications" from "anon";

revoke references on table "public"."notifications" from "anon";

revoke select on table "public"."notifications" from "anon";

revoke trigger on table "public"."notifications" from "anon";

revoke truncate on table "public"."notifications" from "anon";

revoke update on table "public"."notifications" from "anon";

revoke delete on table "public"."permissions" from "anon";

revoke insert on table "public"."permissions" from "anon";

revoke references on table "public"."permissions" from "anon";

revoke select on table "public"."permissions" from "anon";

revoke trigger on table "public"."permissions" from "anon";

revoke truncate on table "public"."permissions" from "anon";

revoke update on table "public"."permissions" from "anon";

revoke delete on table "public"."poll_question_answers" from "anon";

revoke insert on table "public"."poll_question_answers" from "anon";

revoke references on table "public"."poll_question_answers" from "anon";

revoke select on table "public"."poll_question_answers" from "anon";

revoke trigger on table "public"."poll_question_answers" from "anon";

revoke truncate on table "public"."poll_question_answers" from "anon";

revoke update on table "public"."poll_question_answers" from "anon";

revoke delete on table "public"."poll_question_results" from "anon";

revoke insert on table "public"."poll_question_results" from "anon";

revoke references on table "public"."poll_question_results" from "anon";

revoke select on table "public"."poll_question_results" from "anon";

revoke trigger on table "public"."poll_question_results" from "anon";

revoke truncate on table "public"."poll_question_results" from "anon";

revoke update on table "public"."poll_question_results" from "anon";

revoke delete on table "public"."poll_questions" from "anon";

revoke insert on table "public"."poll_questions" from "anon";

revoke references on table "public"."poll_questions" from "anon";

revoke select on table "public"."poll_questions" from "anon";

revoke trigger on table "public"."poll_questions" from "anon";

revoke truncate on table "public"."poll_questions" from "anon";

revoke update on table "public"."poll_questions" from "anon";

revoke delete on table "public"."poll_response_answers" from "anon";

revoke insert on table "public"."poll_response_answers" from "anon";

revoke references on table "public"."poll_response_answers" from "anon";

revoke select on table "public"."poll_response_answers" from "anon";

revoke trigger on table "public"."poll_response_answers" from "anon";

revoke truncate on table "public"."poll_response_answers" from "anon";

revoke update on table "public"."poll_response_answers" from "anon";

revoke delete on table "public"."poll_responses" from "anon";

revoke insert on table "public"."poll_responses" from "anon";

revoke references on table "public"."poll_responses" from "anon";

revoke select on table "public"."poll_responses" from "anon";

revoke trigger on table "public"."poll_responses" from "anon";

revoke truncate on table "public"."poll_responses" from "anon";

revoke update on table "public"."poll_responses" from "anon";

revoke delete on table "public"."polls" from "anon";

revoke insert on table "public"."polls" from "anon";

revoke references on table "public"."polls" from "anon";

revoke select on table "public"."polls" from "anon";

revoke trigger on table "public"."polls" from "anon";

revoke truncate on table "public"."polls" from "anon";

revoke update on table "public"."polls" from "anon";

revoke delete on table "public"."profiles" from "anon";

revoke insert on table "public"."profiles" from "anon";

revoke references on table "public"."profiles" from "anon";

revoke select on table "public"."profiles" from "anon";

revoke trigger on table "public"."profiles" from "anon";

revoke truncate on table "public"."profiles" from "anon";

revoke update on table "public"."profiles" from "anon";

revoke delete on table "public"."repositories" from "anon";

revoke insert on table "public"."repositories" from "anon";

revoke references on table "public"."repositories" from "anon";

revoke select on table "public"."repositories" from "anon";

revoke trigger on table "public"."repositories" from "anon";

revoke truncate on table "public"."repositories" from "anon";

revoke update on table "public"."repositories" from "anon";

revoke delete on table "public"."repository_check_runs" from "anon";

revoke insert on table "public"."repository_check_runs" from "anon";

revoke references on table "public"."repository_check_runs" from "anon";

revoke select on table "public"."repository_check_runs" from "anon";

revoke trigger on table "public"."repository_check_runs" from "anon";

revoke truncate on table "public"."repository_check_runs" from "anon";

revoke update on table "public"."repository_check_runs" from "anon";

revoke delete on table "public"."review_assignment_rubric_parts" from "anon";

revoke insert on table "public"."review_assignment_rubric_parts" from "anon";

revoke references on table "public"."review_assignment_rubric_parts" from "anon";

revoke select on table "public"."review_assignment_rubric_parts" from "anon";

revoke trigger on table "public"."review_assignment_rubric_parts" from "anon";

revoke truncate on table "public"."review_assignment_rubric_parts" from "anon";

revoke update on table "public"."review_assignment_rubric_parts" from "anon";

revoke delete on table "public"."review_assignments" from "anon";

revoke insert on table "public"."review_assignments" from "anon";

revoke references on table "public"."review_assignments" from "anon";

revoke select on table "public"."review_assignments" from "anon";

revoke trigger on table "public"."review_assignments" from "anon";

revoke truncate on table "public"."review_assignments" from "anon";

revoke update on table "public"."review_assignments" from "anon";

revoke delete on table "public"."rubric_check_references" from "anon";

revoke insert on table "public"."rubric_check_references" from "anon";

revoke references on table "public"."rubric_check_references" from "anon";

revoke select on table "public"."rubric_check_references" from "anon";

revoke trigger on table "public"."rubric_check_references" from "anon";

revoke truncate on table "public"."rubric_check_references" from "anon";

revoke update on table "public"."rubric_check_references" from "anon";

revoke delete on table "public"."rubric_checks" from "anon";

revoke insert on table "public"."rubric_checks" from "anon";

revoke references on table "public"."rubric_checks" from "anon";

revoke select on table "public"."rubric_checks" from "anon";

revoke trigger on table "public"."rubric_checks" from "anon";

revoke truncate on table "public"."rubric_checks" from "anon";

revoke update on table "public"."rubric_checks" from "anon";

revoke delete on table "public"."rubric_criteria" from "anon";

revoke insert on table "public"."rubric_criteria" from "anon";

revoke references on table "public"."rubric_criteria" from "anon";

revoke select on table "public"."rubric_criteria" from "anon";

revoke trigger on table "public"."rubric_criteria" from "anon";

revoke truncate on table "public"."rubric_criteria" from "anon";

revoke update on table "public"."rubric_criteria" from "anon";

revoke delete on table "public"."rubric_parts" from "anon";

revoke insert on table "public"."rubric_parts" from "anon";

revoke references on table "public"."rubric_parts" from "anon";

revoke select on table "public"."rubric_parts" from "anon";

revoke trigger on table "public"."rubric_parts" from "anon";

revoke truncate on table "public"."rubric_parts" from "anon";

revoke update on table "public"."rubric_parts" from "anon";

revoke delete on table "public"."rubrics" from "anon";

revoke insert on table "public"."rubrics" from "anon";

revoke references on table "public"."rubrics" from "anon";

revoke select on table "public"."rubrics" from "anon";

revoke trigger on table "public"."rubrics" from "anon";

revoke truncate on table "public"."rubrics" from "anon";

revoke update on table "public"."rubrics" from "anon";

revoke delete on table "public"."sis_sync_status" from "anon";

revoke insert on table "public"."sis_sync_status" from "anon";

revoke references on table "public"."sis_sync_status" from "anon";

revoke select on table "public"."sis_sync_status" from "anon";

revoke trigger on table "public"."sis_sync_status" from "anon";

revoke truncate on table "public"."sis_sync_status" from "anon";

revoke update on table "public"."sis_sync_status" from "anon";

revoke delete on table "public"."student_flashcard_deck_progress" from "anon";

revoke insert on table "public"."student_flashcard_deck_progress" from "anon";

revoke references on table "public"."student_flashcard_deck_progress" from "anon";

revoke select on table "public"."student_flashcard_deck_progress" from "anon";

revoke trigger on table "public"."student_flashcard_deck_progress" from "anon";

revoke truncate on table "public"."student_flashcard_deck_progress" from "anon";

revoke update on table "public"."student_flashcard_deck_progress" from "anon";

revoke delete on table "public"."student_help_activity" from "anon";

revoke insert on table "public"."student_help_activity" from "anon";

revoke references on table "public"."student_help_activity" from "anon";

revoke select on table "public"."student_help_activity" from "anon";

revoke trigger on table "public"."student_help_activity" from "anon";

revoke truncate on table "public"."student_help_activity" from "anon";

revoke update on table "public"."student_help_activity" from "anon";

revoke delete on table "public"."student_karma_notes" from "anon";

revoke insert on table "public"."student_karma_notes" from "anon";

revoke references on table "public"."student_karma_notes" from "anon";

revoke select on table "public"."student_karma_notes" from "anon";

revoke trigger on table "public"."student_karma_notes" from "anon";

revoke truncate on table "public"."student_karma_notes" from "anon";

revoke update on table "public"."student_karma_notes" from "anon";

revoke delete on table "public"."submission_artifact_comments" from "anon";

revoke insert on table "public"."submission_artifact_comments" from "anon";

revoke references on table "public"."submission_artifact_comments" from "anon";

revoke select on table "public"."submission_artifact_comments" from "anon";

revoke trigger on table "public"."submission_artifact_comments" from "anon";

revoke truncate on table "public"."submission_artifact_comments" from "anon";

revoke update on table "public"."submission_artifact_comments" from "anon";

revoke delete on table "public"."submission_artifacts" from "anon";

revoke insert on table "public"."submission_artifacts" from "anon";

revoke references on table "public"."submission_artifacts" from "anon";

revoke select on table "public"."submission_artifacts" from "anon";

revoke trigger on table "public"."submission_artifacts" from "anon";

revoke truncate on table "public"."submission_artifacts" from "anon";

revoke update on table "public"."submission_artifacts" from "anon";

revoke delete on table "public"."submission_comments" from "anon";

revoke insert on table "public"."submission_comments" from "anon";

revoke references on table "public"."submission_comments" from "anon";

revoke select on table "public"."submission_comments" from "anon";

revoke trigger on table "public"."submission_comments" from "anon";

revoke truncate on table "public"."submission_comments" from "anon";

revoke update on table "public"."submission_comments" from "anon";

revoke delete on table "public"."submission_file_comments" from "anon";

revoke insert on table "public"."submission_file_comments" from "anon";

revoke references on table "public"."submission_file_comments" from "anon";

revoke select on table "public"."submission_file_comments" from "anon";

revoke trigger on table "public"."submission_file_comments" from "anon";

revoke truncate on table "public"."submission_file_comments" from "anon";

revoke update on table "public"."submission_file_comments" from "anon";

revoke delete on table "public"."submission_files" from "anon";

revoke insert on table "public"."submission_files" from "anon";

revoke references on table "public"."submission_files" from "anon";

revoke select on table "public"."submission_files" from "anon";

revoke trigger on table "public"."submission_files" from "anon";

revoke truncate on table "public"."submission_files" from "anon";

revoke update on table "public"."submission_files" from "anon";

revoke delete on table "public"."submission_ordinal_counters" from "anon";

revoke insert on table "public"."submission_ordinal_counters" from "anon";

revoke references on table "public"."submission_ordinal_counters" from "anon";

revoke select on table "public"."submission_ordinal_counters" from "anon";

revoke trigger on table "public"."submission_ordinal_counters" from "anon";

revoke truncate on table "public"."submission_ordinal_counters" from "anon";

revoke update on table "public"."submission_ordinal_counters" from "anon";

revoke delete on table "public"."submission_regrade_request_comments" from "anon";

revoke insert on table "public"."submission_regrade_request_comments" from "anon";

revoke references on table "public"."submission_regrade_request_comments" from "anon";

revoke select on table "public"."submission_regrade_request_comments" from "anon";

revoke trigger on table "public"."submission_regrade_request_comments" from "anon";

revoke truncate on table "public"."submission_regrade_request_comments" from "anon";

revoke update on table "public"."submission_regrade_request_comments" from "anon";

revoke delete on table "public"."submission_regrade_requests" from "anon";

revoke insert on table "public"."submission_regrade_requests" from "anon";

revoke references on table "public"."submission_regrade_requests" from "anon";

revoke select on table "public"."submission_regrade_requests" from "anon";

revoke trigger on table "public"."submission_regrade_requests" from "anon";

revoke truncate on table "public"."submission_regrade_requests" from "anon";

revoke update on table "public"."submission_regrade_requests" from "anon";

revoke delete on table "public"."submission_reviews" from "anon";

revoke insert on table "public"."submission_reviews" from "anon";

revoke references on table "public"."submission_reviews" from "anon";

revoke select on table "public"."submission_reviews" from "anon";

revoke trigger on table "public"."submission_reviews" from "anon";

revoke truncate on table "public"."submission_reviews" from "anon";

revoke update on table "public"."submission_reviews" from "anon";

revoke delete on table "public"."submissions" from "anon";

revoke insert on table "public"."submissions" from "anon";

revoke references on table "public"."submissions" from "anon";

revoke select on table "public"."submissions" from "anon";

revoke trigger on table "public"."submissions" from "anon";

revoke truncate on table "public"."submissions" from "anon";

revoke update on table "public"."submissions" from "anon";

revoke delete on table "public"."tags" from "anon";

revoke insert on table "public"."tags" from "anon";

revoke references on table "public"."tags" from "anon";

revoke select on table "public"."tags" from "anon";

revoke trigger on table "public"."tags" from "anon";

revoke truncate on table "public"."tags" from "anon";

revoke update on table "public"."tags" from "anon";

revoke delete on table "public"."users" from "anon";

revoke insert on table "public"."users" from "anon";

revoke references on table "public"."users" from "anon";

revoke select on table "public"."users" from "anon";

revoke trigger on table "public"."users" from "anon";

revoke truncate on table "public"."users" from "anon";

revoke update on table "public"."users" from "anon";

revoke delete on table "public"."video_meeting_sessions" from "anon";

revoke insert on table "public"."video_meeting_sessions" from "anon";

revoke references on table "public"."video_meeting_sessions" from "anon";

revoke select on table "public"."video_meeting_sessions" from "anon";

revoke trigger on table "public"."video_meeting_sessions" from "anon";

revoke truncate on table "public"."video_meeting_sessions" from "anon";

revoke update on table "public"."video_meeting_sessions" from "anon";

revoke delete on table "public"."webhook_process_status" from "anon";

revoke insert on table "public"."webhook_process_status" from "anon";

revoke references on table "public"."webhook_process_status" from "anon";

revoke select on table "public"."webhook_process_status" from "anon";

revoke trigger on table "public"."webhook_process_status" from "anon";

revoke truncate on table "public"."webhook_process_status" from "anon";

revoke update on table "public"."webhook_process_status" from "anon";

revoke delete on table "public"."workflow_events" from "anon";

revoke insert on table "public"."workflow_events" from "anon";

revoke references on table "public"."workflow_events" from "anon";

revoke select on table "public"."workflow_events" from "anon";

revoke trigger on table "public"."workflow_events" from "anon";

revoke truncate on table "public"."workflow_events" from "anon";

revoke update on table "public"."workflow_events" from "anon";

revoke delete on table "public"."workflow_run_error" from "anon";

revoke insert on table "public"."workflow_run_error" from "anon";

revoke references on table "public"."workflow_run_error" from "anon";

revoke select on table "public"."workflow_run_error" from "anon";

revoke trigger on table "public"."workflow_run_error" from "anon";

revoke truncate on table "public"."workflow_run_error" from "anon";

revoke update on table "public"."workflow_run_error" from "anon";

alter table "public"."notification_preferences" drop column "email_digest_frequency";

alter table "public"."notification_preferences" drop column "help_request_message_notifications";

alter table "public"."notification_preferences" drop column "help_request_notifications";

alter table "public"."notification_preferences" add column "help_request_creation_notification" help_request_creation_notification not null;

alter table "public"."notification_preferences" alter column "updated_at" set default now();

alter table "public"."notification_preferences" alter column "updated_at" set not null;

drop type "public"."email_digest_frequency";

drop type "public"."notification_type";

set check_function_bodies = off;

CREATE OR REPLACE FUNCTION public.create_help_request_notification(p_class_id bigint, p_notification_type text, p_help_request_id bigint, p_help_queue_id bigint, p_help_queue_name text, p_creator_profile_id uuid, p_creator_name text, p_assignee_profile_id uuid DEFAULT NULL::uuid, p_assignee_name text DEFAULT NULL::text, p_status help_request_status DEFAULT NULL::help_request_status, p_request_preview text DEFAULT ''::text, p_is_private boolean DEFAULT false, p_action text DEFAULT 'created'::text)
 RETURNS void
 LANGUAGE plpgsql
 SECURITY DEFINER
 SET search_path TO ''
AS $function$
declare
  notification_body jsonb;
begin
  if p_notification_type = 'help_request' then
    notification_body := jsonb_build_object(
      'type', 'help_request',
      'action', p_action,
      'help_request_id', p_help_request_id,
      'help_queue_id', p_help_queue_id,
      'help_queue_name', p_help_queue_name,
      'creator_profile_id', p_creator_profile_id,
      'creator_name', p_creator_name,
      'assignee_profile_id', p_assignee_profile_id,
      'assignee_name', p_assignee_name,
      'status', p_status,
      'request_preview', p_request_preview,
      -- Enrich with subject/body for email templates and digests
      'request_subject', coalesce(
        (
          select hrt.name
          from public.help_request_templates hrt
          where hrt.id = (
            select hr.template_id from public.help_requests hr where hr.id = p_help_request_id
          )
        ),
        'General'
      ),
      'request_body', (
        select hr.request from public.help_requests hr where hr.id = p_help_request_id
      ),
      'is_private', p_is_private
    );
  elsif p_notification_type is null then
    raise exception 'create_help_request_notification: p_notification_type must not be null';
  else
    -- Future-proof: explicitly reject unsupported types
    raise exception 'create_help_request_notification: unsupported p_notification_type=%', p_notification_type;
  end if;

  -- On creation: notify instructors and graders only (do NOT blast the entire class)
  if p_action = 'created' then
    insert into public.notifications (user_id, class_id, subject, body)
    select distinct
      ur.user_id,
      p_class_id,
      jsonb_build_object('text', 'Help Request ' || p_action),
      notification_body
    from public.user_roles ur
    left join public.notification_preferences np
      on np.user_id = ur.user_id and np.class_id = p_class_id
    where ur.class_id = p_class_id
      and ur.role in ('instructor', 'grader')
      and coalesce(np.help_request_creation_notification::text, 'all') <> 'none'
      and (
        coalesce(np.help_request_creation_notification::text, 'all') = 'all'
        or (
          coalesce(np.help_request_creation_notification::text, 'all') = 'only_active_queue'
          and exists (
            select 1
            from public.help_queue_assignments hqa
            where hqa.class_id = p_class_id
              and hqa.help_queue_id = p_help_queue_id
              and hqa.ta_profile_id = ur.private_profile_id
              and hqa.is_active = true
              and hqa.ended_at is null
          )
        )
      );

    -- Ensure the creator is watching their own request
    insert into public.help_request_watchers (user_id, help_request_id, class_id, enabled)
    select ur.user_id, p_help_request_id, p_class_id, true
    from public.user_roles ur
    where ur.private_profile_id = p_creator_profile_id
      and ur.class_id = p_class_id
    on conflict (user_id, help_request_id) do nothing;

  else
    -- For assignment/status changes: notify watchers
    insert into public.notifications (user_id, class_id, subject, body)
    select 
      hrw.user_id,
      p_class_id,
      jsonb_build_object('text', 'Help Request ' || p_action),
      notification_body
    from public.help_request_watchers hrw
    join public.user_roles ur on ur.user_id = hrw.user_id and ur.class_id = p_class_id
    where hrw.help_request_id = p_help_request_id
      and hrw.enabled = true
      and (
        -- For private requests, only notify instructors, graders, creator, and assignee
        (p_is_private and ur.role in ('instructor', 'grader'))
        or (p_is_private and ur.private_profile_id = p_creator_profile_id)
        or (p_is_private and ur.private_profile_id = p_assignee_profile_id)
        -- For public requests, notify all watching users
        or not p_is_private
      );
  end if;
end;
$function$
;


